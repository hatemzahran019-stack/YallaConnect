<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أحدث انتقالات اللاعبين</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <!-- خط Montserrat -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-dark-light: #1c1c1c;
            --text-light: #eeeeee;
            --accent-red-dark: #7a1c1c;
            --border-light: rgba(255, 255, 255, 0.12);
            --fade-duration: 0.3s;
            --primary: #FFD700;
            --secondary: #1E1E1E;
            --accent: #FF5722;
            --success: #4CAF50;
            --loan: #2196F3;
            --free: #9C27B0;
        }
        
        /* شاشة التحميل */
        .pure-loader {
            width: 60px;
            height: 60px;
            border: 6px solid #444;
            border-top: 6px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        #splashScreen { 
            background: linear-gradient(135deg, #000000, #001a11); 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .rotate { animation: spin 0.6s linear; }
        
        /* أنماط النقاط المتحركة */
        .dots-loader {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 20px;
            text-align: center;
        }
        
        .dots-loader span {
            position: relative;
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #999;
            margin: 0 3px;
            opacity: 0;
        }
        
        .dots-loader span:nth-child(1) {
            animation: dot-pulse 1.5s infinite;
        }
        
        .dots-loader span:nth-child(2) {
            animation: dot-pulse 1.5s infinite 0.2s;
        }
        
        .dots-loader span:nth-child(3) {
            animation: dot-pulse 1.5s infinite 0.4s;
        }
        
        @keyframes dot-pulse {
            0% {
                opacity: 0;
                transform: scale(0.7) translateY(5px);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) translateY(0);
            }
            100% {
                opacity: 0;
                transform: scale(0.7) translateY(5px);
            }
        }
        
        /* الهيدر */
        header {
            position: sticky;
            top: 0;
            z-index: 999;
            background-color: #0047ab;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            margin-bottom: 0px;
            font-family: 'Montserrat', sans-serif;
        }
        
        header i { font-size: 20px; cursor: pointer; }
        header h1 { margin: 0; font-size: 20px; font-family: 'Montserrat', sans-serif; }
        .header-buttons { display: flex; gap: 10px; background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center; }
        .header-buttons a { color: white; font-size: 22px; text-decoration: none; transition: color 0.3s; }
        .header-buttons a:hover { color: #cfd8dc; }
        
        /* المحتوى الرئيسي */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0f0f0f;
            color: var(--text-light);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        /* بطاقات الانتقالات */
        .transfers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 0px;
        }
        
        .transfer-card {
            background: #272727;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            outline: none;
        }
        
        .transfer-card:focus, .transfer-card.selected {
            transform: scale(1.02);
            
            border-color: #0047ab;
            z-index: 1;
        }
        
        .transfer-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }
        
        .transfer-card[data-type="انتقال"]::after {
            background: #999;
        }
        
        .transfer-card[data-type="إعارة"]::after {
            background: #999;
        }
        
        .transfer-card[data-type="انتقال حر"]::after {
            background: #999;
        }
        
        .player-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #999;
            margin-left: 15px;
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0;
            color: #999;
        }
        
        .player-position {
            font-size: 0.8rem;
            color: #bbb;
            margin: 5px 0 0;
        }
        
        .clubs {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            position: relative;
        }
        
        .club-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            background-color: #fff;
            border-radius: 8px;
            padding: 3px;
        }
        
        .transfer-arrow {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #0047ab;
            background: #0f0f0f;
            border-radius: 10px;
            padding: 10px 18px;
            z-index: 2;
        }
        
        .transfer-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
        }
        
        .transfer-type {
            font-size: 0.8rem;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 15px;
        }
        
        .transfer-type[data-type="انتقال"] {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .transfer-type[data-type="إعارة"] {
            background-color: rgba(33, 150, 243, 0.2);
            color: var(--loan);
        }
        
        .transfer-type[data-type="انتقال حر"] {
            background-color: rgba(156, 39, 176, 0.2);
            color: var(--free);
        }
        
        .transfer-price {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* رسائل التحميل والخطأ */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
        
        .error-message {
            text-align: center;
            padding: 40px;
            color: #ff5555;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
        
        /* زر التحديث */
        .refresh-icon {
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .refresh-icon:hover {
            transform: rotate(180deg);
        }
        
        /* زر الصعود للأعلى */
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 50px;
            height: 50px;
            background-color: #0047ab;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-to-top i {
            color: white;
            font-size: 20px;
        }
        
        @media (max-width: 768px) {
            .transfers-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .transfers-grid {
                grid-template-columns: 1fr;
            }
            
            .player-header {
                flex-direction: column;
                text-align: center;
            }
            
            .player-img {
                margin-left: 0;
                margin-bottom: 15px;
            }
            
            .scroll-to-top {
                bottom: 20px;
                left: 20px;
                width: 40px;
                height: 40px;
            }
            
            .scroll-to-top i {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="header-buttons">
        <span id="refreshIcon" class="refresh-icon"><i class="fa fa-refresh"></i></span>
    </div>
    <h1>Yalla Connect</h1>
    <div class="header-buttons">
        <a href="go:services"><i class="fas fa-arrow-left"></i></a>
    </div>
</header>

<div class="container">
    <div class="transfers-grid" id="transfers"></div>
</div>

<!-- زر الصعود للأعلى -->
<div class="scroll-to-top" id="scrollToTop" title="الصعود للأعلى">
    <i class="fas fa-arrow-up"></i>
</div>

<script>
// إعدادات API
const API_URL = "https://ko.best-goal.live/transation.php";
const PROXY_URL = "https://corsproxy.io/?";
const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 دقائق

// عناصر DOM
const transfersContainer = document.getElementById('transfers');
const refreshIcon = document.getElementById('refreshIcon');
const scrollToTopBtn = document.getElementById('scrollToTop');
let refreshInterval;
let currentSelectedCard = 0;
let transferCards = [];

// دالة لجلب البيانات من API
async function fetchTransfers() {
    try {
        showLoading();
        
        const response = await fetch(PROXY_URL + encodeURIComponent(API_URL));
        
        if (!response.ok) {
            throw new Error(`خطأ في الشبكة: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success && Array.isArray(data.data)) {
            renderTransfers(data.data);
        } else {
            showError("لا توجد بيانات متاحة حالياً");
        }
    } catch (error) {
        console.error('Error fetching transfers:', error);
        showError("حدث خطأ أثناء جلب البيانات");
    } finally {
        // إيقاف دوران أيقونة التحديث
        refreshIcon.querySelector('i').classList.remove('rotate');
    }
}

// دالة لعرض البيانات
function renderTransfers(transfers) {
    if (!transfers || transfers.length === 0) {
        showError("لا توجد انتقالات متاحة حالياً");
        return;
    }
    
    transfersContainer.innerHTML = '';
    
    transfers.forEach((transfer, index) => {
        const transferCard = document.createElement('div');
        transferCard.className = 'transfer-card';
        transferCard.setAttribute('data-type', transfer.transfer_type);
        transferCard.setAttribute('tabindex', '0');
        transferCard.setAttribute('data-index', index);
        
        transferCard.innerHTML = `
            <div class="player-header">
                <img class="player-img" src="${transfer.player_image}" alt="${transfer.player_name}" 
                     onerror="this.src='https://via.placeholder.com/70?text=PLAYER'">
                <div class="player-info">
                    <h3 class="player-name">${transfer.player_name}</h3>
                    <p class="player-position">${transfer.player_position}</p>
                </div>
            </div>
            
            <div class="clubs">
                <img class="club-logo" src="${transfer.to_club_logo}" alt="النادي الجديد"
                     onerror="this.src='https://via.placeholder.com/50?text=CLUB'">
                
                <div class="transfer-arrow"><i class="fa-solid fa-arrow-right"></i></div>
                
                <img class="club-logo" src="${transfer.from_club_logo}" alt="النادي السابق"
                     onerror="this.src='https://via.placeholder.com/50?text=CLUB'">
            </div>
            
            <div class="transfer-footer">
                <span class="transfer-type" data-type="${transfer.transfer_type}">
                    ${transfer.transfer_type}
                </span>
                <span class="transfer-price">
                    ${transfer.transfer_price || ''}
                </span>
            </div>
        `;
        
        transfersContainer.appendChild(transferCard);
    });
    
    // تحديث مصفوفة البطاقات بعد التحميل
    transferCards = Array.from(document.querySelectorAll('.transfer-card'));
    
    // إضافة أحداث النقر للبطاقات
    transferCards.forEach((card, index) => {
        card.addEventListener('click', () => {
            // إزالة التحديد من جميع البطاقات
            transferCards.forEach(c => {
                c.classList.remove('selected');
                c.blur();
            });
            
            // تحديد البطاقة المنقولة عليها
            card.classList.add('selected');
            card.focus();
            currentSelectedCard = index;
        });
    });
    
    // التركيز على البطاقة الأولى عند التحميل
    if (transferCards.length > 0) {
        setTimeout(() => {
            transferCards[0].classList.add('selected');
            transferCards[0].focus();
            currentSelectedCard = 0;
        }, 100);
    }
}

// دالة لعرض حالة التحميل
function showLoading() {
    transfersContainer.innerHTML = `
        <div class="loading">
            <div class="dots-loader">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    `;
}

// دالة لعرض رسالة الخطأ
function showError(message) {
    transfersContainer.innerHTML = `
        <div class="error-message">
            ${message}
            <button onclick="fetchTransfers()" style="
                margin-top: 15px;
                padding: 8px 20px;
                background: var(--primary);
                color: #000;
                border: none;
                border-radius: 20px;
                font-weight: bold;
                cursor: pointer;
                font-family: 'Cairo', sans-serif;
            ">إعادة المحاولة</button>
        </div>
    `;
}

// دالة لبدء التحديث التلقائي
function startAutoRefresh() {
    clearInterval(refreshInterval);
    refreshInterval = setInterval(fetchTransfers, REFRESH_INTERVAL);
}

// دالة للتنقل بين البطاقات
function navigateCards(direction) {
    if (transferCards.length === 0) return;
    
    // إزالة التركيز والتحديد من البطاقة الحالية
    transferCards[currentSelectedCard].classList.remove('selected');
    transferCards[currentSelectedCard].blur();
    
    if (direction === 'up') {
        currentSelectedCard = Math.max(0, currentSelectedCard - 1);
    } else if (direction === 'down') {
        currentSelectedCard = Math.min(transferCards.length - 1, currentSelectedCard + 1);
    }
    
    // إضافة التركيز والتحديد على البطاقة الجديدة
    transferCards[currentSelectedCard].classList.add('selected');
    transferCards[currentSelectedCard].focus();
    
    // التمرير إلى البطاقة المحددة
    transferCards[currentSelectedCard].scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
    });
    
    // إظهار أو إخفاء زر الصعود للأعلى
    toggleScrollToTopButton();
}

// دالة للتعامل مع أحداث لوحة المفاتيح
function handleKeyDown(e) {
    switch(e.key) {
        case 'ArrowUp':
            navigateCards('up');
            e.preventDefault();
            break;
        case 'ArrowDown':
            navigateCards('down');
            e.preventDefault();
            break;
        case 'Enter':
            // يمكنك إضافة فعل عند الضغط على زر الإدخال
            break;
    }
}

// دالة لإظهار أو إخفاء زر الصعود للأعلى
function toggleScrollToTopButton() {
    if (window.scrollY > 300 || currentSelectedCard > 3) {
        scrollToTopBtn.classList.add('visible');
    } else {
        scrollToTopBtn.classList.remove('visible');
    }
}

// دالة للصعود إلى الأعلى
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
    
    // التركيز على البطاقة الأولى عند الصعود للأعلى
    if (transferCards.length > 0) {
        transferCards.forEach(c => {
            c.classList.remove('selected');
            c.blur();
        });
        
        transferCards[0].classList.add('selected');
        transferCards[0].focus();
        currentSelectedCard = 0;
    }
    
    toggleScrollToTopButton();
}

// أحداث
refreshIcon.addEventListener('click', () => {
    refreshIcon.querySelector('i').classList.add('rotate');
    fetchTransfers();
});

scrollToTopBtn.addEventListener('click', scrollToTop);

// أحداث لوحة المفاتيح
document.addEventListener('keydown', handleKeyDown);

// أحداث التمرير
window.addEventListener('scroll', toggleScrollToTopButton);

// تهيئة الصفحة
document.addEventListener('DOMContentLoaded', () => {
    fetchTransfers();
    startAutoRefresh();
    
    // إخفاء زر الصعود للأعلى في البداية
    toggleScrollToTopButton();
});

// تحديث البيانات عند عودة الاتصال
window.addEventListener('online', fetchTransfers);
</script>

</body>
</html>